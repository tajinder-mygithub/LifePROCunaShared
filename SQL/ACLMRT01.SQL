--@**20100811*******************************************
--@** 
--@** Licensed Materials - Property of
--@** ExlService Holdings, Inc.
--@**  
--@** (C) 1983-2010 ExlService Holdings, Inc.  All Rights Reserved.
--@** 
--@** Contains confidential and trade secret information.  
--@** Copyright notice is precautionary only and does not
--@** imply publication.
--@** 
--@**20100811*******************************************
--Description
-- DROP CLAIM TRIGGERS ON PCLMR

DROP TRIGGER PCLMR_TRIG_INSERT
DROP TRIGGER PCLMR_TRIG_DELETE
DROP TRIGGER PCLMR_TRIG_UPDATE
;

----------------------------------------------------------------------------------------
---- Trigger For Insert ----------------------------------------------------------------
----------------------------------------------------------------------------------------
CREATE TRIGGER PCLMR_TRIG_INSERT on PCLMR FOR INSERT
 AS
  INSERT INTO XCLAIM_RELATION (COMPANY_CODE,CLAIM_NUMBER,DETAIL_SEQ,PAYMENT_SEQ,ADJ_SEQ,RELATE_CODE,NAME_ID)
       SELECT COMPANY_CODE,CLAIM_NUMBER,0,0,0,'LH',L_HOSPITAL_NAME_ID FROM Inserted WHERE L_HOSPITAL_NAME_ID>0
  INSERT INTO XCLAIM_RELATION (COMPANY_CODE,CLAIM_NUMBER,DETAIL_SEQ,PAYMENT_SEQ,ADJ_SEQ,RELATE_CODE,NAME_ID)
       SELECT COMPANY_CODE,CLAIM_NUMBER,0,0,0,'LA',L_PAYEE_NAME_ID FROM Inserted WHERE L_PAYEE_NAME_ID>0
  INSERT INTO XCLAIM_RELATION (COMPANY_CODE,CLAIM_NUMBER,DETAIL_SEQ,PAYMENT_SEQ,ADJ_SEQ,RELATE_CODE,NAME_ID)
       SELECT COMPANY_CODE,CLAIM_NUMBER,0,0,0,'LP',L_PHYSICIAN_NAMEID FROM Inserted WHERE L_PHYSICIAN_NAMEID>0
  INSERT INTO XCLAIM_RELATION (COMPANY_CODE,CLAIM_NUMBER,DETAIL_SEQ,PAYMENT_SEQ,ADJ_SEQ,RELATE_CODE,NAME_ID)
       SELECT COMPANY_CODE,CLAIM_NUMBER,0,0,0,'LV',L_PROVIDER_NAME_ID FROM Inserted WHERE L_PROVIDER_NAME_ID>0
  INSERT INTO XCLAIM_RELATION (COMPANY_CODE,CLAIM_NUMBER,DETAIL_SEQ,PAYMENT_SEQ,ADJ_SEQ,RELATE_CODE,NAME_ID)
       SELECT COMPANY_CODE,CLAIM_NUMBER,0,0,0,'SV',S_PROVIDER_NAME_ID FROM Inserted WHERE S_PROVIDER_NAME_ID>0
  INSERT INTO XCLAIM_RELATION (COMPANY_CODE,CLAIM_NUMBER,DETAIL_SEQ,PAYMENT_SEQ,ADJ_SEQ,RELATE_CODE,NAME_ID)
       SELECT COMPANY_CODE,CLAIM_NUMBER,0,0,0,'SA',S_PAYEE_NAME_ID FROM Inserted WHERE S_PAYEE_NAME_ID>0
  INSERT INTO XCLAIM_RELATION (COMPANY_CODE,CLAIM_NUMBER,DETAIL_SEQ,PAYMENT_SEQ,ADJ_SEQ,RELATE_CODE,NAME_ID)
       SELECT COMPANY_CODE,CLAIM_NUMBER,0,0,0,'MV',M_PROVIDER_NAME_ID FROM Inserted WHERE M_PROVIDER_NAME_ID>0
  INSERT INTO XCLAIM_RELATION (COMPANY_CODE,CLAIM_NUMBER,DETAIL_SEQ,PAYMENT_SEQ,ADJ_SEQ,RELATE_CODE,NAME_ID)
       SELECT COMPANY_CODE,CLAIM_NUMBER,0,0,0,'MA',M_PAYEE_NAME_ID FROM Inserted WHERE M_PAYEE_NAME_ID>0
  INSERT INTO XCLAIM_RELATION (COMPANY_CODE,CLAIM_NUMBER,DETAIL_SEQ,PAYMENT_SEQ,ADJ_SEQ,RELATE_CODE,NAME_ID)
       SELECT COMPANY_CODE,CLAIM_NUMBER,0,0,0,'RV',R_PROVIDER_NAME_ID FROM Inserted WHERE R_PROVIDER_NAME_ID>0
;

----------------------------------------------------------------------------------------
---- Trigger For Delete ----------------------------------------------------------------
----------------------------------------------------------------------------------------
CREATE TRIGGER PCLMR_TRIG_DELETE on PCLMR FOR DELETE
 AS
DECLARE @CLAIM_NUMBER    CHAR (12)
DECLARE @COMPANY_CODE    CHAR (2)
SET @CLAIM_NUMBER=(SELECT CLAIM_NUMBER FROM Deleted)
SET @COMPANY_CODE=(SELECT COMPANY_CODE FROM Deleted)

  DELETE FROM XCLAIM_RELATION
   WHERE COMPANY_CODE=@COMPANY_CODE
     AND CLAIM_NUMBER=@CLAIM_NUMBER
     AND DETAIL_SEQ  = 0
     AND PAYMENT_SEQ = 0
     AND ADJ_SEQ     = 0
;

----------------------------------------------------------------------------------------
---- Trigger For Update (Delete and Insert)---------------------------------------------
----------------------------------------------------------------------------------------
CREATE TRIGGER PCLMR_TRIG_UPDATE on PCLMR FOR UPDATE
 AS
DECLARE @CLAIM_NUMBER    CHAR (12)
DECLARE @COMPANY_CODE    CHAR (2)
SET @CLAIM_NUMBER=(SELECT CLAIM_NUMBER FROM Deleted)
SET @COMPANY_CODE=(SELECT COMPANY_CODE FROM Deleted)

  DELETE FROM XCLAIM_RELATION
   WHERE COMPANY_CODE=@COMPANY_CODE
     AND CLAIM_NUMBER=@CLAIM_NUMBER
     AND DETAIL_SEQ  = 0
     AND PAYMENT_SEQ = 0
     AND ADJ_SEQ     = 0

  INSERT INTO XCLAIM_RELATION (COMPANY_CODE,CLAIM_NUMBER,DETAIL_SEQ,PAYMENT_SEQ,ADJ_SEQ,RELATE_CODE,NAME_ID)
       SELECT COMPANY_CODE,CLAIM_NUMBER,0,0,0,'LH',L_HOSPITAL_NAME_ID FROM Inserted WHERE L_HOSPITAL_NAME_ID>0
  INSERT INTO XCLAIM_RELATION (COMPANY_CODE,CLAIM_NUMBER,DETAIL_SEQ,PAYMENT_SEQ,ADJ_SEQ,RELATE_CODE,NAME_ID)
       SELECT COMPANY_CODE,CLAIM_NUMBER,0,0,0,'LA',L_PAYEE_NAME_ID FROM Inserted WHERE L_PAYEE_NAME_ID>0
  INSERT INTO XCLAIM_RELATION (COMPANY_CODE,CLAIM_NUMBER,DETAIL_SEQ,PAYMENT_SEQ,ADJ_SEQ,RELATE_CODE,NAME_ID)
       SELECT COMPANY_CODE,CLAIM_NUMBER,0,0,0,'LP',L_PHYSICIAN_NAMEID FROM Inserted WHERE L_PHYSICIAN_NAMEID>0
  INSERT INTO XCLAIM_RELATION (COMPANY_CODE,CLAIM_NUMBER,DETAIL_SEQ,PAYMENT_SEQ,ADJ_SEQ,RELATE_CODE,NAME_ID)
       SELECT COMPANY_CODE,CLAIM_NUMBER,0,0,0,'LV',L_PROVIDER_NAME_ID FROM Inserted WHERE L_PROVIDER_NAME_ID>0
  INSERT INTO XCLAIM_RELATION (COMPANY_CODE,CLAIM_NUMBER,DETAIL_SEQ,PAYMENT_SEQ,ADJ_SEQ,RELATE_CODE,NAME_ID)
       SELECT COMPANY_CODE,CLAIM_NUMBER,0,0,0,'SV',S_PROVIDER_NAME_ID FROM Inserted WHERE S_PROVIDER_NAME_ID>0
  INSERT INTO XCLAIM_RELATION (COMPANY_CODE,CLAIM_NUMBER,DETAIL_SEQ,PAYMENT_SEQ,ADJ_SEQ,RELATE_CODE,NAME_ID)
       SELECT COMPANY_CODE,CLAIM_NUMBER,0,0,0,'SA',S_PAYEE_NAME_ID FROM Inserted WHERE S_PAYEE_NAME_ID>0
  INSERT INTO XCLAIM_RELATION (COMPANY_CODE,CLAIM_NUMBER,DETAIL_SEQ,PAYMENT_SEQ,ADJ_SEQ,RELATE_CODE,NAME_ID)
       SELECT COMPANY_CODE,CLAIM_NUMBER,0,0,0,'MV',M_PROVIDER_NAME_ID FROM Inserted WHERE M_PROVIDER_NAME_ID>0
  INSERT INTO XCLAIM_RELATION (COMPANY_CODE,CLAIM_NUMBER,DETAIL_SEQ,PAYMENT_SEQ,ADJ_SEQ,RELATE_CODE,NAME_ID)
       SELECT COMPANY_CODE,CLAIM_NUMBER,0,0,0,'MA',M_PAYEE_NAME_ID FROM Inserted WHERE M_PAYEE_NAME_ID>0
  INSERT INTO XCLAIM_RELATION (COMPANY_CODE,CLAIM_NUMBER,DETAIL_SEQ,PAYMENT_SEQ,ADJ_SEQ,RELATE_CODE,NAME_ID)
       SELECT COMPANY_CODE,CLAIM_NUMBER,0,0,0,'RV',R_PROVIDER_NAME_ID FROM Inserted WHERE R_PROVIDER_NAME_ID>0
;
