--@**20100811*******************************************
--@** 
--@** Licensed Materials - Property of
--@** ExlService Holdings, Inc.
--@**  
--@** (C) 1983-2010 ExlService Holdings, Inc.  All Rights Reserved.
--@** 
--@** Contains confidential and trade secret information.  
--@** Copyright notice is precautionary only and does not
--@** imply publication.
--@** 
--@**20100811*******************************************
--Description
-- DROP CLAIM TRIGGERS ON PCLMD

DROP TRIGGER PCLMD_TRIG_INSERT
DROP TRIGGER PCLMD_TRIG_DELETE
DROP TRIGGER PCLMD_TRIG_UPDATE
;

----------------------------------------------------------------------------------------
---- Trigger For Insert ----------------------------------------------------------------
----------------------------------------------------------------------------------------
CREATE TRIGGER PCLMD_TRIG_INSERT on PCLMD FOR INSERT
 AS
  INSERT INTO XCLAIM_RELATION (COMPANY_CODE,CLAIM_NUMBER,DETAIL_SEQ,PAYMENT_SEQ,ADJ_SEQ,RELATE_CODE,NAME_ID)
       SELECT COMPANY_CODE,CLAIM_NUMBER,DETAIL_SEQ,PAYMENT_SEQ,ADJ_SEQ,'CA',PAYEE_NAME_ID FROM Inserted WHERE PAYEE_NAME_ID>0
  INSERT INTO XCLAIM_RELATION (COMPANY_CODE,CLAIM_NUMBER,DETAIL_SEQ,PAYMENT_SEQ,ADJ_SEQ,RELATE_CODE,NAME_ID)
       SELECT COMPANY_CODE,CLAIM_NUMBER,DETAIL_SEQ,PAYMENT_SEQ,ADJ_SEQ,'CP',PROVIDER_NAME_ID FROM Inserted WHERE PROVIDER_NAME_ID>0
  INSERT INTO XCLAIM_RELATION (COMPANY_CODE,CLAIM_NUMBER,DETAIL_SEQ,PAYMENT_SEQ,ADJ_SEQ,RELATE_CODE,NAME_ID)
       SELECT COMPANY_CODE,CLAIM_NUMBER,DETAIL_SEQ,PAYMENT_SEQ,ADJ_SEQ,'CC',CLAIMANT_NAME_ID FROM Inserted WHERE CLAIMANT_NAME_ID>0
  INSERT INTO XCLAIM_RELATION (COMPANY_CODE,CLAIM_NUMBER,DETAIL_SEQ,PAYMENT_SEQ,ADJ_SEQ,RELATE_CODE,NAME_ID)
       SELECT COMPANY_CODE,CLAIM_NUMBER,DETAIL_SEQ,PAYMENT_SEQ,ADJ_SEQ,'CR',REINS_CO_NAME_ID FROM Inserted WHERE REINS_CO_NAME_ID>0
;

----------------------------------------------------------------------------------------
---- Trigger For Delete ----------------------------------------------------------------
----------------------------------------------------------------------------------------
CREATE TRIGGER PCLMD_TRIG_DELETE on PCLMD FOR DELETE
 AS
DECLARE @COMPANY_CODE  char (2)
DECLARE @CLAIM_NUMBER  char (12)
DECLARE @DETAIL_SEQ    smallint
DECLARE @PAYMENT_SEQ   smallint
DECLARE @ADJ_SEQ       smallint
SET @COMPANY_CODE=(SELECT COMPANY_CODE FROM Deleted)
SET @CLAIM_NUMBER=(SELECT CLAIM_NUMBER FROM Deleted)
SET @DETAIL_SEQ  =(SELECT DETAIL_SEQ   FROM Deleted)
SET @PAYMENT_SEQ =(SELECT PAYMENT_SEQ  FROM Deleted)
SET @ADJ_SEQ     =(SELECT ADJ_SEQ      FROM Deleted)

  DELETE FROM XCLAIM_RELATION
   WHERE COMPANY_CODE=@COMPANY_CODE
     AND CLAIM_NUMBER=@CLAIM_NUMBER
     AND DETAIL_SEQ  =@DETAIL_SEQ
     AND PAYMENT_SEQ =@PAYMENT_SEQ
     AND ADJ_SEQ     =@ADJ_SEQ
;

----------------------------------------------------------------------------------------
---- Trigger For Update (Delete and Insert)---------------------------------------------
----------------------------------------------------------------------------------------
CREATE TRIGGER PCLMD_TRIG_UPDATE on PCLMD FOR UPDATE
 AS
DECLARE @COMPANY_CODE  char (2)
DECLARE @CLAIM_NUMBER  char (12)
DECLARE @DETAIL_SEQ    smallint
DECLARE @PAYMENT_SEQ   smallint
DECLARE @ADJ_SEQ       smallint
SET @COMPANY_CODE=(SELECT COMPANY_CODE FROM Deleted)
SET @CLAIM_NUMBER=(SELECT CLAIM_NUMBER FROM Deleted)
SET @DETAIL_SEQ  =(SELECT DETAIL_SEQ   FROM Deleted)
SET @PAYMENT_SEQ =(SELECT PAYMENT_SEQ  FROM Deleted)
SET @ADJ_SEQ     =(SELECT ADJ_SEQ      FROM Deleted)

  DELETE FROM XCLAIM_RELATION
   WHERE COMPANY_CODE=@COMPANY_CODE
     AND CLAIM_NUMBER=@CLAIM_NUMBER
     AND DETAIL_SEQ  =@DETAIL_SEQ
     AND PAYMENT_SEQ =@PAYMENT_SEQ
     AND ADJ_SEQ     =@ADJ_SEQ

  INSERT INTO XCLAIM_RELATION (COMPANY_CODE,CLAIM_NUMBER,DETAIL_SEQ,PAYMENT_SEQ,ADJ_SEQ,RELATE_CODE,NAME_ID)
       SELECT COMPANY_CODE,CLAIM_NUMBER,DETAIL_SEQ,PAYMENT_SEQ,ADJ_SEQ,'CA',PAYEE_NAME_ID FROM Inserted WHERE PAYEE_NAME_ID>0
  INSERT INTO XCLAIM_RELATION (COMPANY_CODE,CLAIM_NUMBER,DETAIL_SEQ,PAYMENT_SEQ,ADJ_SEQ,RELATE_CODE,NAME_ID)
       SELECT COMPANY_CODE,CLAIM_NUMBER,DETAIL_SEQ,PAYMENT_SEQ,ADJ_SEQ,'CP',PROVIDER_NAME_ID FROM Inserted WHERE PROVIDER_NAME_ID>0
  INSERT INTO XCLAIM_RELATION (COMPANY_CODE,CLAIM_NUMBER,DETAIL_SEQ,PAYMENT_SEQ,ADJ_SEQ,RELATE_CODE,NAME_ID)
       SELECT COMPANY_CODE,CLAIM_NUMBER,DETAIL_SEQ,PAYMENT_SEQ,ADJ_SEQ,'CC',CLAIMANT_NAME_ID FROM Inserted WHERE CLAIMANT_NAME_ID>0
  INSERT INTO XCLAIM_RELATION (COMPANY_CODE,CLAIM_NUMBER,DETAIL_SEQ,PAYMENT_SEQ,ADJ_SEQ,RELATE_CODE,NAME_ID)
       SELECT COMPANY_CODE,CLAIM_NUMBER,DETAIL_SEQ,PAYMENT_SEQ,ADJ_SEQ,'CR',REINS_CO_NAME_ID FROM Inserted WHERE REINS_CO_NAME_ID>0
;
